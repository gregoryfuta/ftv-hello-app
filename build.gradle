buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath('io.sealights.on-premise.agents.plugin:sealights-gradle-plugin:3.1.735')
    }
}

plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.6'
    id 'io.spring.dependency-management' version '1.1.0'
}

group = 'dev.futa.sealights'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '1.8'

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

ext {
    set('testcontainersVersion', "1.17.6")
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.testcontainers:junit-jupiter'
}

dependencyManagement {
    imports {
        mavenBom "org.testcontainers:testcontainers-bom:${testcontainersVersion}"
    }
}

tasks.named('test') {
    useJUnitPlatform()
}

allprojects.each { p ->
    def included = []
    def excluded = []

    if (!included.isEmpty()) {
        println "[SeaLights Integration] Including only projects: ${included}"
    }

    if (!excluded.isEmpty()) {
        println "[SeaLights Integration] Excluding projects: ${excluded}"
    }

    if (!excluded.contains(p.name) &&
            (included.isEmpty() || included.contains(p.name))) {
        println "[SeaLights Integration] SeaLights applied to project: '${p.name}'"

        p.afterEvaluate {

            p.apply plugin: io.sealights.onpremise.agents.plugin.SealightsPlugin
            p.sealights {

                token = "eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL0RFVi1mdHYuYXV0aC5zZWFsaWdodHMuaW8vIiwiand0aWQiOiJERVYtZnR2LGktMGMxNjU4YjA0ZTljMDMwMzMsQVBJR1ctOTYzN2FjOGUtMzAyYy00YTk1LTkyZjItZGExNTFiNDljNDI0LDE2NzA0MjE2MzI1NDAiLCJzdWJqZWN0IjoiU2VhTGlnaHRzQGFnZW50IiwiYXVkaWVuY2UiOlsiYWdlbnRzIl0sIngtc2wtcm9sZSI6ImFnZW50IiwieC1zbC1zZXJ2ZXIiOiJodHRwczovL2Rldi1mdHYtZ3cuZGV2LnNlYWxpZ2h0cy5jby9hcGkiLCJzbF9pbXBlcl9zdWJqZWN0IjoiIiwiaWF0IjoxNjcwNDIxNjMyfQ.IyAO7_zibgusLv_pPwTwlBICvRwh7EbC7Ee-Zqmx6azkjaRYDb8olKjiWM_HeYFGnIIczAuWIurFUm-h9noPOzLp-0h-r6fu3Yt4utvF9b1NhQNtL9aLlJ4-h7kDZA7K5AN39Agx6DB_be9XLcLHnwANskq16xn-H6xOOqq-VFqrN98hUl_sRiHf0CKm6RbsumyF1byqZIizENT7unGfJc6tP0poNRgpJkue0UJklgT6HRT8bPi_7rJJgUAu6Vb0LhkCManH_CsllFMxSMBFMJWM-Zxvs5pKHmK1JcIuy08i0r0cJR1axLDtFXcx8Fn_u1dtpLMk-BZCUCOKxh-YXT651AjvCsHwX2JCqxlcD7aLaQIMC3mmq6Qie7YezILQ6_GYDu-oREVgQsN2eob2k0oiFloLn4AmJllq66GasP8Oq20MuHScWvop95McYiictsdHohkkb_z97UIj70LF49qNTJxy5ZGeY90vbZ34mFBfF7cTAXY47q5ReqpyokYx-DABpjFYgS-1i6x_e-4_3Zreni1-SOmueHhhFS_S9hC-gLXvJuiDwIDPaxR16eF_I-S4w0l0071ddqt_-8HgoQcfV85zOzpgHz7IjCfhDIUDB3eI_uwW523hV-4eCoM8ElRa7lCfhQlL2iwEn-623dVjEZI1cD2sfX3B1_efpQ4"
                appName = "gf-ftv-lab003"
                filesIncluded = "*.class"
                filesExcluded = "*test-classes*"
                packagesIncluded = "*dev.futa.sealights.*"
                packagesExcluded = ""
                recursive = true
                includeResources = true
                testStage = "Unit Tests"
                logEnabled = true
                logPluginMinimal = false
                logToConsole = true
                logLevel = "debug"
                logFolder = ".\\tmp"
                createBuildSessionId = true
                sealightsJvmParams = [:]
                build = "${slBuildName}"
                branch = "classic"
                buildScannerJar = "C:\\projekty\\SL.OnPremise.Agents.Java\\java-build-agent\\target\\java-build-agent-4.0.0-SNAPSHOT.jar"
                testListenerJar = "C:\\projekty\\SL.OnPremise.Agents.Java\\java-agent-bootstrapper\\target\\java-agent-bootstrapper-4.0.0-SNAPSHOT.jar"
            }
        }
    }
}
